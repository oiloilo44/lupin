# E2E 테스트 시나리오 정의서

> 현재 시스템의 모든 핵심 동작을 정의하여 새 아키텍처의 완성 기준으로 활용

## 🎮 월급루팡 오목 게임 핵심 시나리오

### 1. 기본 게임 플로우 (Single Happy Path)

#### S1-1: 방 생성 및 게임 시작
```
사용자 동작:
1. 메인 페이지 접속 (localhost:8002)
2. "오목" 게임 선택 클릭
3. 닉네임 "Player1" 입력
4. "방 만들기" 버튼 클릭
5. 방 생성 대기 상태 확인

검증 포인트:
- 방 ID가 생성되어 URL에 표시됨
- "방을 생성했습니다" 토스트 메시지 표시
- "상대방을 기다리는 중..." 상태 표시
- 게임 보드가 비활성화 상태로 표시
- Excel 스타일 UI가 정상 적용됨
```

#### S1-2: 두 번째 플레이어 입장
```
사용자 동작:
1. 새 브라우저/탭에서 같은 방 URL 접속
2. 닉네임 "Player2" 입력
3. "입장하기" 버튼 클릭

검증 포인트:
- 두 브라우저 모두 "게임 시작!" 토스트 표시
- 현재 턴 표시가 "Player1" 으로 설정
- 게임 보드가 활성화됨
- 양쪽 브라우저에서 플레이어 정보 동기화
```

#### S1-3: 턴제 게임 진행
```
사용자 동작:
1. Player1이 (7,7) 위치에 흑돌 놓기
2. 턴이 Player2로 변경되는지 확인
3. Player2가 (8,8) 위치에 백돌 놓기
4. 5-10수 정도 진행

검증 포인트:
- 돌 놓기 즉시 상대방 화면에 반영
- 턴 표시가 정확하게 변경됨
- 놓인 돌의 색상이 정확함 (흑/백)
- 이미 놓인 자리에는 놓을 수 없음
- 미리보기 돌 표시 정상 작동
```

### 2. 멀티플레이어 실시간 동기화

#### S2-1: 동시 접속 및 동기화
```
테스트 시나리오:
1. 브라우저 A, B 동시에 같은 방 입장
2. 양쪽에서 거의 동시에 돌 놓기 시도
3. 서버 검증 및 선착순 처리 확인

검증 포인트:
- 먼저 도착한 요청만 처리됨
- 늦은 요청은 거부되고 오류 메시지 표시
- 게임 상태가 양쪽에서 일치함
- 턴 순서가 정확히 유지됨
```

#### S2-2: 네트워크 지연 시뮬레이션
```
테스트 시나리오:
1. 한쪽 브라우저의 네트워크 지연 발생
2. 지연된 상황에서도 게임 진행
3. 지연 해결 후 상태 동기화

검증 포인트:
- 지연 중에도 다른 플레이어는 정상 진행
- 지연 해결 시 모든 상태가 정확히 동기화
- 중복 액션이나 상태 불일치 없음
```

### 3. 재접속 및 세션 복원

#### S3-1: 게임 중 페이지 새로고침
```
사용자 동작:
1. 게임 진행 중 (5-6수 진행된 상태)
2. 한 플레이어가 페이지 새로고침 (F5)
3. 기존 세션으로 자동 복원

검증 포인트:
- 새로고침 후 즉시 게임 상태 복원
- 보드의 모든 돌 위치 정확히 복원
- 현재 턴 정확히 표시
- 상대방과 즉시 재동기화
- "재접속되었습니다" 토스트 표시
```

#### S3-2: 브라우저 완전 종료 후 재접속
```
사용자 동작:
1. 게임 진행 중 브라우저 완전 종료
2. 5분 내 같은 URL로 재접속
3. 기존 세션 복원 시도

검증 포인트:
- 세션 ID 기반 자동 로그인
- 게임 상태 정확한 복원
- 상대방에게 "상대방이 재접속했습니다" 알림
- 이어서 게임 진행 가능
```

### 4. 월급루팡 특화 UI/UX

#### S4-1: Excel 위장 모드
```
테스트 시나리오:
1. 게임 화면이 Excel과 유사하게 보이는지 확인
2. 상단 메뉴바, 툴바가 Excel 스타일인지 확인
3. 게임 영역이 Excel 셀 영역처럼 보이는지 확인

검증 포인트:
- 전체적인 색상/폰트가 Excel과 유사
- 게임 타이틀이나 로고가 눈에 띄지 않음
- 업무용 소프트웨어처럼 보이는 디자인
- 불필요한 화려한 요소 없음
```

#### S4-2: 투명도 조절 기능
```
사용자 동작:
1. 우측 투명도 슬라이더 조작
2. 게임 영역 투명도 변경 확인
3. 다양한 투명도에서 게임 진행

검증 포인트:
- 슬라이더로 투명도 실시간 조절 가능
- 게임 영역만 투명해지고 Excel 배경은 유지
- 투명도 변경해도 게임 진행에 문제없음
- 설정이 로컬에 저장됨
```

#### S4-3: 빠른 숨김 기능 (Escape)
```
사용자 동작:
1. 게임 진행 중 Escape 키 누르기
2. 다시 Escape 키 눌러서 복원
3. 버튼으로도 동일한 동작 테스트

검증 포인트:
- Escape 즉시 게임 화면 완전 투명화
- Excel 배경만 남아서 업무 화면처럼 보임
- 다시 Escape로 게임 화면 복원
- 게임 상태는 그대로 유지됨
```

### 5. 게임 기능 (무르기/재시작/채팅)

#### S5-1: 본인 턴에서 무르기 요청 (상대방 수 무르기)
```
사용자 동작:
1. Player1이 3-4수 진행
2. Player2가 수를 놓은 직후 (Player1 턴)
3. Player1이 "무르기" 버튼 클릭
4. Player2에게 무르기 요청 팝업 표시
5. Player2가 수락/거절 선택

검증 포인트:
- 무르기 버튼이 게임 도중 활성화되어 있음
- Player2의 마지막 수가 제거됨 (수락 시)
- 턴이 다시 Player2로 변경됨
- Player1에게는 무르기 요청 팝업이 표시되지 않음
- 거절 시 게임이 그대로 진행됨
```

#### S5-2: 상대 턴에서 무르기 요청 (내 수 무르기)
```
사용자 동작:
1. Player1이 수를 놓음
2. Player2 턴이 된 상태에서
3. Player1이 "무르기" 버튼 클릭 (자신의 마지막 수 무르기)
4. Player2에게 무르기 요청 팝업 표시
5. Player2가 수락/거절 선택

검증 포인트:
- 상대 턴에서도 무르기 버튼이 활성화되어 있음
- Player1의 마지막 수가 제거됨 (수락 시)
- 턴이 다시 Player1로 변경됨
- 무르기 후 턴 순서가 정확히 조정됨
- 거절 시 Player2 턴 그대로 유지
```

#### S5-3: 게임 도중 버튼 활성화 상태 확인
```
테스트 시나리오:
1. 게임 시작 직후 (아직 수를 놓지 않은 상태)
2. 3-5수 진행된 상태
3. 10수 이상 진행된 상태
4. 각 상황에서 무르기/재시작 버튼 상태 확인

검증 포인트:
- 게임 시작 직후에는 무르기 버튼 비활성화 또는 숨김
- 첫 수를 놓은 후부터 무르기 버튼 활성화
- 재시작 버튼은 게임 시작과 동시에 활성화
- 게임 종료 후에는 두 버튼 모두 비활성화
- 버튼 클릭 시 적절한 반응 (로딩, 비활성화 등)
```

#### S5-4: 재시작 요청 및 처리
```
사용자 동작:
1. 게임 진행 중 "재시작" 버튼 클릭
2. 재시작 요청이 정상적으로 전송되는지 확인
3. 상대방에게 재시작 요청 팝업 표시
4. 상대방이 수락/거절 선택

검증 포인트:
- 재시작 버튼이 게임 도중 활성화되어 있음
- 재시작 요청 팝업이 상대방에게만 표시
- 수락 시 보드 완전 초기화
- 선공/후공 순서 유지 또는 변경 규칙 적용
- 거절 시 기존 게임 계속
- 재시작 요청 중에는 버튼 비활성화
```

#### S5-5: 실시간 채팅
```
사용자 동작:
1. 채팅창에 "안녕하세요" 메시지 입력
2. Enter 키로 전송
3. 상대방 화면에서 메시지 확인

검증 포인트:
- 메시지 즉시 상대방에게 전달
- 보낸 사람 닉네임과 메시지 정확 표시
- 긴 메시지 처리 (줄바꿈, 스크롤)
- HTML 태그 입력 시 XSS 방지
- 빈 메시지나 공백만 있는 메시지 차단
```

### 6. 게임 종료 및 승부 판정

#### S6-1: 5목 달성 승리
```
테스트 시나리오:
1. 한 플레이어가 가로/세로/대각선 5목 완성
2. 승리 판정 및 게임 종료
3. 결과 표시 및 후속 액션

검증 포인트:
- 5목 달성 즉시 게임 종료
- 승리자/패배자 정확한 표시
- 승리한 5목 라인 하이라이트
- 양쪽 화면에 결과 동기화
- "새 게임" 또는 "나가기" 옵션 제공
```

#### S6-2: 게임 중 나가기
```
사용자 동작:
1. 게임 진행 중 "나가기" 버튼 클릭
2. 확인 팝업에서 "확인" 클릭
3. 메인 페이지로 이동

검증 포인트:
- 나가기 전 확인 팝업 표시
- 상대방에게 "상대방이 나갔습니다" 알림
- 세션 정리 및 메모리 해제
- WebSocket 연결 정상 종료
```

### 7. 에러 처리 및 복구

#### S7-1: WebSocket 연결 끊김
```
테스트 시나리오:
1. 게임 진행 중 서버 재시작 또는 네트워크 끊김
2. 자동 재연결 시도
3. 연결 복구 후 상태 동기화

검증 포인트:
- "연결이 끊어졌습니다" 상태 표시
- 자동 재연결 시도 진행률 표시
- 재연결 성공 시 게임 상태 복원
- 재연결 실패 시 수동 재연결 옵션
```

#### S7-2: 잘못된 입력 처리
```
테스트 시나리오:
1. 빈 닉네임으로 입장 시도
2. 이미 사용 중인 방 ID 접속
3. 게임 종료된 방에 접속 시도

검증 포인트:
- 적절한 오류 메시지 표시
- 사용자가 수정할 수 있는 안내 제공
- 치명적 오류 시에도 페이지 크래시 없음
- 오류 후 정상 플로우로 복구 가능
```

### 8. 성능 및 안정성

#### S8-1: 장시간 게임 진행
```
테스트 시나리오:
1. 50수 이상 장기간 게임 진행
2. 메모리 사용량 모니터링
3. WebSocket 연결 안정성 확인

검증 포인트:
- 메모리 누수 없음
- WebSocket 연결 유지
- UI 반응성 저하 없음
- 게임 상태 정확성 유지
```

#### S8-2: 다중 방 동시 운영
```
테스트 시나리오:
1. 여러 방에서 동시 게임 진행
2. 방 간 간섭 없이 독립적 운영
3. 서버 리소스 사용량 확인

검증 포인트:
- 방별 완전 격리
- 다른 방 게임 영향 없음
- 서버 성능 안정적 유지
```

---

## 🎯 테스트 우선순위

### 🔴 Critical (반드시 통과해야 함)
- S1: 기본 게임 플로우
- S2: 멀티플레이어 실시간 동기화
- S3: 재접속 및 세션 복원
- S6: 게임 종료 및 승부 판정

### 🟡 Important (새 아키텍처에서 개선되어야 함)
- S4: 월급루팡 특화 UI/UX
- S5: 게임 기능 (무르기/재시작/채팅)
- S7: 에러 처리 및 복구

### 🟢 Nice to have (성능 및 확장성 검증)
- S8: 성능 및 안정성

---

**다음 단계**: 이 시나리오들을 Python Playwright로 자동화 테스트 구현
