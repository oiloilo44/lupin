{% extends "base.html" %}

{% block content %}
<div class="game-menu">
    <div class="game-card" onclick="showSlitherComingSoon()">
        <h3>ğŸ ì§€ë ì´ ê²Œì„</h3>
        <p>ë©€í‹°í”Œë ˆì´ì–´ ì‹¤ì‹œê°„ ì§€ë ì´ ê²Œì„<br>ì—¬ëŸ¬ ëª…ì´ í•¨ê»˜ í”Œë ˆì´</p>
    </div>
    
    <div class="game-card" onclick="showOmokMenu()">
        <h3>âš« ì˜¤ëª©</h3>
        <p>1:1 ëŒ€ì „ ì˜¤ëª© ê²Œì„<br>ë°©ì„ ë§Œë“¤ê±°ë‚˜ ì°¸ì—¬í•˜ì„¸ìš”</p>
    </div>
    
    <div class="game-card" onclick="showJanggiComingSoon()">
        <h3>â™ ì¥ê¸°</h3>
        <p>ì „í†µ ì¥ê¸° ê²Œì„<br>ì¹œêµ¬ì™€ ë‘ë‡Œ ëŒ€ê²°</p>
    </div>
    
    <div class="game-card" onclick="showSettings()">
        <h3>âš™ï¸ ì„¤ì •</h3>
        <p>ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½<br>ê²Œì„ ì„¤ì •</p>
    </div>
</div>

<!-- ì˜¤ëª© ë©”ë‰´ -->
<div id="omokMenu" style="display: none; text-align: center; padding: 20px;">
    <h3>âš« ì˜¤ëª© ê²Œì„</h3>
    <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
        <div class="game-card" onclick="createOmokRoom()" style="width: 200px; margin: 0;">
            <h4>ë°© ë§Œë“¤ê¸°</h4>
            <p>ìƒˆë¡œìš´ ê²Œì„ ë°©ì„<br>ë§Œë“¤ì–´ ì¹œêµ¬ë¥¼ ì´ˆëŒ€</p>
        </div>
        <div class="game-card" onclick="showJoinRoom()" style="width: 200px; margin: 0;">
            <h4>ë°© ì°¸ì—¬í•˜ê¸°</h4>
            <p>ì¹œêµ¬ê°€ ë³´ë‚¸ ë§í¬ë¡œ<br>ê²Œì„ì— ì°¸ì—¬</p>
        </div>
    </div>
    <button onclick="backToMainMenu()" style="padding: 8px 16px; margin-top: 10px;">ë’¤ë¡œ ê°€ê¸°</button>
</div>

<!-- ë°© ì°¸ì—¬ -->
<div id="joinRoomMenu" style="display: none; text-align: center; padding: 20px;">
    <h3>ë°© ì°¸ì—¬í•˜ê¸°</h3>
    <p>ì¹œêµ¬ì—ê²Œ ë°›ì€ ë°© ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
    <input type="text" id="roomLinkInput" placeholder="ë°© ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="width: 300px; padding: 10px; margin: 10px;">
    <br>
    <button onclick="joinRoomByLink()" style="margin: 5px; padding: 8px 16px;">ë°© ì…ì¥</button>
    <button onclick="backToOmokMenu()" style="margin: 5px; padding: 8px 16px;">ë’¤ë¡œ ê°€ê¸°</button>
</div>

<!-- ë°© ìƒì„± ì™„ë£Œ -->
<div id="roomCreated" style="display: none; text-align: center; padding: 20px;">
    <h3>ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
    <p>ì•„ë˜ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê³  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì—¬ ê²Œì„ì— ì…ì¥í•˜ì„¸ìš”:</p>
    <input type="text" id="roomUrl" readonly style="width: 80%; padding: 8px; margin: 10px; text-align: center;">
    <br>
    <button onclick="copyToClipboard()" style="margin: 5px; padding: 8px 16px;">ë§í¬ ë³µì‚¬</button>
    <br><br>
    <div style="margin: 20px 0;">
        <p><strong>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ê²Œì„ì— ì…ì¥í•˜ì„¸ìš”:</strong></p>
        <input type="text" id="hostNickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="10" style="padding: 8px; margin: 5px; width: 200px;">
        <br>
        <button onclick="joinRoomAsHost()" style="margin: 5px; padding: 8px 16px; background: #10b981; color: white;">ê²Œì„ ì…ì¥</button>
    </div>
    <button onclick="backToOmokMenu()" style="margin: 5px; padding: 8px 16px;">ë’¤ë¡œ ê°€ê¸°</button>
</div>

<!-- ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">ì œëª©</h3>
        </div>
        <div class="modal-body" id="modalBody">
            ë‚´ìš©
        </div>
        <div class="modal-footer" id="modalFooter">
            <!-- ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>

<!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
<div class="toast-container" id="toastContainer"></div>
{% endblock %}

{% block extra_js %}
<script>
let currentRoomUrl = '';
let currentRoomPath = '';

function showOmokMenu() {
    document.querySelector('.game-menu').style.display = 'none';
    document.getElementById('omokMenu').style.display = 'block';
}

function backToMainMenu() {
    document.querySelector('.game-menu').style.display = 'grid';
    document.getElementById('omokMenu').style.display = 'none';
    document.getElementById('joinRoomMenu').style.display = 'none';
    document.getElementById('roomCreated').style.display = 'none';
}

function showJoinRoom() {
    document.getElementById('omokMenu').style.display = 'none';
    document.getElementById('joinRoomMenu').style.display = 'block';
}

function backToOmokMenu() {
    document.getElementById('omokMenu').style.display = 'block';
    document.getElementById('joinRoomMenu').style.display = 'none';
    document.getElementById('roomCreated').style.display = 'none';
}

async function createOmokRoom() {
    try {
        const response = await fetch('/omok/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        currentRoomUrl = window.location.origin + data.url;
        currentRoomPath = data.url;
        showRoomCreated(currentRoomUrl);
    } catch (error) {
        console.error('Error creating Omok room:', error);
        showModal('ì˜¤ë¥˜', 'ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', [
            { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
        ]);
    }
}

function showJanggiComingSoon() {
    showModal('ğŸš§ ê°œë°œ ì¤‘', 'ì¥ê¸° ê²Œì„ì€ í˜„ì¬ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.<br><br>ì „í†µ ì¥ê¸°ì˜ ê¹Šì´ ìˆëŠ” ì „ëµì„ ì˜¨ë¼ì¸ìœ¼ë¡œ ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ ì¤€ë¹„ ì¤‘ì´ë‹ˆ, ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!', [
        { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
    ]);
}

function showSlitherComingSoon() {
    showModal('ğŸš§ ê°œë°œ ì¤‘', 'ì§€ë ì´ ê²Œì„ì€ í˜„ì¬ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.<br><br>ì‹¤ì‹œê°„ ë©€í‹°í”Œë ˆì´ì–´ë¡œ ì—¬ëŸ¬ ëª…ì´ í•¨ê»˜ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ì§€ë ì´ ê²Œì„ì„ ì¤€ë¹„ ì¤‘ì´ë‹ˆ, ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!', [
        { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
    ]);
}

function showRoomCreated(url) {
    document.getElementById('omokMenu').style.display = 'none';
    document.getElementById('roomCreated').style.display = 'block';
    document.getElementById('roomUrl').value = url;
}

function joinRoomByLink() {
    const linkInput = document.getElementById('roomLinkInput');
    const link = linkInput.value.trim();
    
    if (!link) {
        showModal('ì•Œë¦¼', 'ë°© ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', [
            { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
        ]);
        return;
    }
    
    // ë§í¬ì—ì„œ ê²½ë¡œ ì¶”ì¶œ
    try {
        const url = new URL(link);
        const path = url.pathname;
        if (path.startsWith('/omok/')) {
            window.location.href = link;
        } else {
            showModal('ì˜¤ë¥˜', 'ì˜¬ë°”ë¥¸ ì˜¤ëª© ë°© ë§í¬ê°€ ì•„ë‹™ë‹ˆë‹¤.', [
                { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
            ]);
        }
    } catch (error) {
        showModal('ì˜¤ë¥˜', 'ì˜¬ë°”ë¥¸ ë§í¬ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', [
            { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
        ]);
    }
}

function joinRoomAsHost() {
    const nickname = document.getElementById('hostNickname').value.trim();
    if (!nickname) {
        showModal('ì•Œë¦¼', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', [
            { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
        ]);
        return;
    }
    
    // ë‹‰ë„¤ì„ì„ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³  ë°©ìœ¼ë¡œ ì´ë™
    sessionStorage.setItem('hostNickname', nickname);
    window.location.href = currentRoomPath;
}

function copyToClipboard() {
    const urlInput = document.getElementById('roomUrl');
    urlInput.select();
    navigator.clipboard.writeText(urlInput.value).then(() => {
        showToast('ë³µì‚¬ ì™„ë£Œ', 'ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    }).catch(() => {
        // Fallback for older browsers
        document.execCommand('copy');
        showToast('ë³µì‚¬ ì™„ë£Œ', 'ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    });
}

function showSettings() {
    showModal('ì•Œë¦¼', 'ì„¤ì • ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.', [
        { text: 'í™•ì¸', class: 'primary', onclick: hideModal }
    ]);
}
</script>
{% endblock %}