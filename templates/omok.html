{% extends "base.html" %}
{% from "components/chat.html" import chat_panel, chat_resources, chat_init_script %}

{% block content %}
<div id="nicknameForm" class="nickname-form">
    <h3>ì˜¤ëª© ê²Œì„ ì°¸ì—¬</h3>
    <p>ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ê²Œì„ì— ì°¸ì—¬í•˜ì„¸ìš”</p>
    <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
    <button onclick="joinGame()">ê²Œì„ ì°¸ì—¬</button>
</div>

<div id="existingGameForm" class="nickname-form" style="display: none;">
    <h3>ê¸°ì¡´ ê²Œì„ ë°œê²¬</h3>
    <p>ì§„í–‰ ì¤‘ì¸ ê²Œì„ì´ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <div style="display: flex; gap: 10px; justify-content: center;">
        <button onclick="continueExistingGame()" class="primary">ì´ì–´í•˜ê¸°</button>
        <button onclick="startNewGame()" class="secondary">ìƒˆ ê²Œì„</button>
    </div>
</div>

<div id="gameArea" style="display: none;">
    <div class="connection-status" id="connectionStatus" style="display: none;">
        <span id="connectionIcon">ğŸ”´</span>
        <span id="connectionText">ì—°ê²° ëŠê¹€</span>
    </div>
    
    <div id="gameLayout" style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <canvas id="omokBoard" width="450" height="450" style="border: 2px solid #333; background: #ffffff; cursor: pointer; touch-action: none;"></canvas>
        </div>
        
        <div style="width: 180px;">
            <div class="game-info-panel">
                <h4>í”Œë ˆì´ì–´</h4>
                <div id="playerList"></div>
            </div>
            
            <div class="game-info-panel">
                <h4>í˜„ì¬ í„´</h4>
                <div id="currentTurn">-</div>
            </div>
            
            <div class="game-info-panel">
                <h4>ê²Œì„ ì •ë³´</h4>
                <div class="game-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="moveCount">0</div>
                        <div class="stat-label">ì´ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gameTime">00:00</div>
                        <div class="stat-label">ê²½ê¸° ì‹œê°„</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 20px; max-width: 600px;">
        {{ chat_panel(title="ê²Œì„ ì±„íŒ…", height="120px") }}
    </div>
    
    <div style="margin-top: 15px; text-align: center;">
        <button onclick="requestUndo()" id="undoButton" style="padding: 8px 16px; margin: 5px;" disabled>ë¬´ë¥´ê¸°</button>
        <button onclick="requestRestart()" id="restartButton" style="padding: 8px 16px; margin: 5px;">ê²Œì„ ì¬ì‹œì‘</button>
        <button onclick="confirmLeaveRoom()" style="padding: 8px 16px; margin: 5px;">ë°© ë‚˜ê°€ê¸°</button>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">ì œëª©</h3>
        </div>
        <div class="modal-body" id="modalBody">
            ë‚´ìš©
        </div>
        <div class="modal-footer" id="modalFooter">
        </div>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>
<div class="confetti-container" id="confettiContainer"></div>
{% endblock %}

{% block extra_css %}
{{ chat_resources() }}
<style>

/* ë²„íŠ¼ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ ê°œì„  */
button:disabled {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
    transform: none !important;
}

button:disabled:hover {
    background-color: inherit !important;
    transform: none !important;
}

/* ê²Œì„ ë³´ë“œ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ */
#omokBoard {
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

#omokBoard.highlight {
    box-shadow: 0 0 15px rgba(0, 150, 255, 0.3);
    border-color: #0096ff;
}

#omokBoard.invalid-move {
    border-color: #ff4444;
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
}
</style>
{% endblock %}

{% block extra_js %}
{{ chat_init_script() }}
<script src="/static/js/omok.js"></script>
<script>
// ì„œë²„ì—ì„œ ì „ë‹¬ëœ ë™ì  ë°ì´í„°
window.omokGameConfig = {
    roomId: '{{ room_id }}',
    sessionId: '{{ session_id }}',
    gameState: {{ game_state | tojson | safe }},
    playerData: {{ player_data | tojson | safe }}
};

// OmokGameClient ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    window.omokClient = new OmokGameClient(
        window.omokGameConfig.roomId,
        window.omokGameConfig.sessionId,
        window.omokGameConfig.gameState,
        window.omokGameConfig.playerData
    );
    window.omokClient.initialize();
});
</script>
{% endblock %}